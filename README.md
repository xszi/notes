# notes

## 什么是重构？

* 对软件内部整体结构的一种调整。
* 运用大量微小且保持软件行为的步骤，一步步达到大规模的修改。

### 微重构：

确定重构功能和范围 ——> 旧架构设计和逻辑梳理 ——> 稳定性保证 ——> 性能保证 ——> 需求过程中的冲突问题

## 微前端实现方式对比

Iframe

优势：
* 技术成熟
* 支持页面嵌入
* 天然支持运行沙箱隔离，独立运行

劣势：
* 页面之间可以是不同的域名
* 需要对应的设计一套应用通讯机制，如何监听，传参格式等内容
* 应用加载，渲染，缓存等体系的实现

web component（H5）

优势：
* 支持自定义元素
* 支持shadow dom， 可以通过关联进行控制
* 支持模块template和插槽slot，引入自定义组件内容
劣势：
* 接入微前端需要重写当前项目
* 生态系统不完善，技术过新容易出现兼容行问题
* 整体架构设计复杂，组件与组件之间拆分过细时，容易造成通讯和控制繁琐

自研框架spa

优势：
* 高度定制化，满足需要做兼容的一切场景
* 独立的通信机制和沙箱运行机制，可解决应用之间相互影响的问题
* 支持不同技术栈子应用，可无缝实现页面无刷新渲染
劣势：
* 技术实现难度较高
* 需要设计一套定制的通信机制
* 首次加载会出现资源过大的情况

### 实现

* 路由分发式
* 主应用控制路由匹配和子应用加载，共享依赖加载
* 子应用做功能，并接入主应用实现主子控制和联动

## 技术选型

* 主应用（vue3）
* 子应用（vue2/vue3/react15/react16）
* 后端服务和发布应用
* 服务端接口（koa）
* 发布应用（node/express）

## 绘制项目架构图

分析需求：

1. 主应用
    * 注册子应用
    * 加载、渲染子应用
    * 路由匹配 （activeWhen， rules - 由框架判断）
    * 获取数据（公共依赖，通过数据做鉴权处理）
    * 通信（父子通信，子父通信）

2. 子应用的功能
    * 渲染
    * 监听通信（主应用传递过来的数据）

3. 微前端框架

4. 服务端的功能

5. 发布平台
主子应用的发布和打包